#!/usr/bin/env node

if (process.env.NODE_ENV !== 'production') {
  require('dotenv').config({ silent: true })
}

const createDbConnection = require('../lib/db')
const log = require('../lib/logger')
const User = require('../app/models/user')

const mongoose = createDbConnection(log)

User.collection.drop()

const createAdmin = () => User.create({
  username: 'admin',
  email: 'admin@example.com',
  password: 'qaz123',
  passwordConfirmation: 'qaz123',
  admin: true,
  activated: true,
  activated_at: Date.now()
})

User.remove()
  .then(createAdmin)
  .then(() => { mongoose.connection.close() })
